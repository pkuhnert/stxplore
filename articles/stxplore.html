<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="stxplore">
<title>Exploration using dataframes • stxplore</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Exploration using dataframes">
<meta property="og:description" content="stxplore">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">stxplore</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/stxplore.html">Exploration using dataframes</a>
    <a class="dropdown-item" href="../articles/stxplore_stars.html">Exploration using stars objects</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Exploration using dataframes</h1>
            
      
      
      <div class="d-none name"><code>stxplore.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sevvandi.github.io/stxplore/">stxplore</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="the-dataset">The dataset<a class="anchor" aria-label="anchor" href="#the-dataset"></a>
</h2>
<p>We are using the NOAA dataset used in the book
<strong>Spatio-Temporal Statistics with R</strong> by
<strong>Christopher K. Wikle, Andrew Zammit-Mangion</strong> and
<strong>Noel Cressie</strong>. The dataset we’re using contains
precipitation, maximum and minimum temperatures for the years 1990 to
1993 for some regions in the United States. Let’s have a look at the
dataset.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NOAA_df_1990"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">NOAA_df_1990</span><span class="op">)</span></span>
<span><span class="co">#&gt;   julian year month day   id  z proc   lat       lon       date</span></span>
<span><span class="co">#&gt; 1 726834 1990     1   1 3804 35 Tmax 39.35 -81.43333 1990-01-01</span></span>
<span><span class="co">#&gt; 2 726835 1990     1   2 3804 42 Tmax 39.35 -81.43333 1990-01-02</span></span>
<span><span class="co">#&gt; 3 726836 1990     1   3 3804 49 Tmax 39.35 -81.43333 1990-01-03</span></span>
<span><span class="co">#&gt; 4 726837 1990     1   4 3804 59 Tmax 39.35 -81.43333 1990-01-04</span></span>
<span><span class="co">#&gt; 5 726838 1990     1   5 3804 41 Tmax 39.35 -81.43333 1990-01-05</span></span>
<span><span class="co">#&gt; 6 726839 1990     1   6 3804 45 Tmax 39.35 -81.43333 1990-01-06</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="initial-explorations">Initial explorations<a class="anchor" aria-label="anchor" href="#initial-explorations"></a>
</h2>
<p>First we’re going to explore this dataset using simple methods.</p>
<div class="section level3">
<h3 id="spatial-snapshots-through-time">Spatial snapshots through time<a class="anchor" aria-label="anchor" href="#spatial-snapshots-through-time"></a>
</h3>
<p>We will focus on the maximum temperature and see how it changes over
time in 1993. First we will filter the data for Tmax for year 1993 and
months 5 to 9. The the field <em>julian</em> has a unique number for
each day. We will make a new column to represent the days starting from
1 and select certain days.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NOAA_df_1990</span>,</span>
<span>  <span class="va">proc</span> <span class="op">==</span> <span class="st">"Tmax"</span> <span class="op">&amp;</span></span>
<span>  <span class="va">month</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">5</span><span class="op">:</span><span class="fl">9</span> <span class="op">&amp;</span></span>
<span>  <span class="va">year</span> <span class="op">==</span> <span class="fl">1993</span><span class="op">)</span></span>
<span><span class="va">Tmax</span><span class="op">$</span><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">Tmax</span><span class="op">$</span><span class="va">julian</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">Tmax</span><span class="op">$</span><span class="va">julian</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="va">Tmax_days</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Tmax</span>, <span class="va">t</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can use the <em>spatial_snapshots</em> function. For this
function we need to give the data frame and the columns which are used
for latitude, longitude, time and the column which has the quantity we
want to plot. You can also give the main and legend title for the
plot.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spatial_snapshots.html">spatial_snapshots</a></span><span class="op">(</span><span class="va">Tmax_days</span>, </span>
<span>         lat_col <span class="op">=</span> <span class="st">'lat'</span>, </span>
<span>         lon_col <span class="op">=</span> <span class="st">'lon'</span>, </span>
<span>         t_col <span class="op">=</span> <span class="st">'t'</span>, </span>
<span>         z_col <span class="op">=</span> <span class="st">'z'</span>,  </span>
<span>         title <span class="op">=</span> <span class="st">"Maximum Temperature for 3 days"</span>,</span>
<span>         legend_title <span class="op">=</span> <span class="st">'Temp'</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/ssnap1-1.png" width="700"></p>
<p>Suppose we want to plot the maximum temperature for days 1 to 12.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Tmax_days</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Tmax</span>, <span class="va">t</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/spatial_snapshots.html">spatial_snapshots</a></span><span class="op">(</span><span class="va">Tmax_days</span>, </span>
<span>         lat_col <span class="op">=</span> <span class="st">'lat'</span>, </span>
<span>         lon_col <span class="op">=</span> <span class="st">'lon'</span>, </span>
<span>         t_col <span class="op">=</span> <span class="st">'t'</span>, </span>
<span>         z_col <span class="op">=</span> <span class="st">'z'</span>,  </span>
<span>         title <span class="op">=</span> <span class="st">"Maximum Temperature for 12 days"</span>,</span>
<span>         legend_title <span class="op">=</span> <span class="st">'Temp'</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/ssnap2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="time-series-snapshots-for-different-locations">Time series snapshots for different locations<a class="anchor" aria-label="anchor" href="#time-series-snapshots-for-different-locations"></a>
</h3>
<p>We have looked at spatial snapshots over time. Now let’s look at
temporal snapshots for given spatial locations. First let’s look at the
location ids and sample 12 of them.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">148</span><span class="op">)</span>                                          </span>
<span><span class="va">Tmax_ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Tmax</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>                               </span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">Tmax_ID</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">ids</span></span>
<span><span class="co">#&gt;  [1] 14926 93842 14848 93820  3919 94918 13871 94823 13988  3952 13971  3841</span></span></code></pre></div>
<p>Then we use the <em>temporal_snapshots</em> function to plot the
temporal snapshots at those locations. Similar to the previous function,
we need to specify the dataframe, time column, value column, the id
column and the id samples. You can specify the x and y labels and the
title.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/temporal_snapshots.html">temporal_snapshots</a></span><span class="op">(</span><span class="va">Tmax</span>, </span>
<span>         t_col <span class="op">=</span> <span class="st">'t'</span>, </span>
<span>         z_col <span class="op">=</span> <span class="st">'z'</span>, </span>
<span>         id_col <span class="op">=</span> <span class="st">'id'</span>, </span>
<span>         id_sample <span class="op">=</span> <span class="va">ids</span>,  </span>
<span>         xlab <span class="op">=</span> <span class="st">"Days"</span>, </span>
<span>         ylab<span class="op">=</span><span class="st">"Temperature"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"Temperature Selected Days"</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/tsnap1-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="spatial-empirical-means-averaged-over-time">Spatial empirical means (averaged over time)<a class="anchor" aria-label="anchor" href="#spatial-empirical-means-averaged-over-time"></a>
</h3>
<p>Suppose we want to explore the average value for the time period.
That is, for every location we average the values over time. We can see
how the average value changes for different latitude and longitude
values. As our quantity of interest is Maximum Temperature, we get the
Mean Maximum Temperature in these plots. We can also see that there is a
relationship between Mean Maximum Temperature and the Latitude, but not
the Longitude, which is expected.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sem</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_means.html">spatial_means</a></span><span class="op">(</span><span class="va">Tmax</span>, </span>
<span>       lat_col <span class="op">=</span> <span class="st">"lat"</span>, </span>
<span>       lon_col <span class="op">=</span> <span class="st">"lon"</span>, </span>
<span>       t_col <span class="op">=</span> <span class="st">"t"</span>, </span>
<span>       z_col <span class="op">=</span> <span class="st">"z"</span> </span>
<span>       <span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">sem</span>, ylab<span class="op">=</span><span class="st">"Mean Max Temp"</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/sem1-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; TableGrob (2 x 2) "arrange": 3 grobs</span></span>
<span><span class="co">#&gt;   z     cells    name                 grob</span></span>
<span><span class="co">#&gt; 1 1 (2-2,1-1) arrange       gtable[layout]</span></span>
<span><span class="co">#&gt; 2 2 (2-2,2-2) arrange       gtable[layout]</span></span>
<span><span class="co">#&gt; 3 3 (1-1,1-2) arrange text[GRID.text.1423]</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="temporal-empirical-means-averaged-over-space">Temporal empirical means (averaged over space)<a class="anchor" aria-label="anchor" href="#temporal-empirical-means-averaged-over-space"></a>
</h3>
<p>Similarly, we can plot the averages over space and see their
fluctuations over time. In this case, we’re computing the average for
each date over all the latitude and longitude values. We see a graph
with the observed and the average values for each date.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">tem</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/temporal_means.html">temporal_means</a></span><span class="op">(</span><span class="va">Tmax</span>,</span>
<span>                      t_col <span class="op">=</span> <span class="st">'date'</span>,</span>
<span>                      z_col <span class="op">=</span> <span class="st">'z'</span>,</span>
<span>                      id_col <span class="op">=</span> <span class="st">'id'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">tem</span>,</span>
<span>         ylab <span class="op">=</span> <span class="st">"Mean Maximum Temperature"</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/tem1-1.png" width="700"></p>
<p>We finish the initial explorations with the Hovmoller plots.</p>
</div>
<div class="section level3">
<h3 id="hovmoller-plots">Hovmoller plots<a class="anchor" aria-label="anchor" href="#hovmoller-plots"></a>
</h3>
<p>Hovmollet plots are generally used to reduce spatial dimensions. It
is sometimes called a cross between a map and a graph. It is commmonly
used to collapse one of the spatial dimensions. In our example we have
the maximum temperature for different latitude, longitude and time
values. We can average by latitude and see how the maximum temperature
changes with time and longitude. Or we can average by longitude and
explore the changes in maximum temperature with respect to latitude and
time.</p>
<p>The function <em>hovmoller</em> takes similar arguments to the other
functions with the exception of <em>lat_or_lon</em> and
<em>lat_or_lon_col</em> arguments. The argument <em>lat_or_lon</em>
specifies, which spatial component we will see in the plot. If we
specify <em>lat</em>, then we will see a plot of the quantity of
interest (Max Temp in our case) with latitude and time as the two axes.
If we specify <em>lon</em>, then we will see longitude on the x-axis.
The argument <em>lat_or_lon_col</em> is used to specify the column
corresponding to the spatial variable.</p>
<p>To average by longitude, we need to specify <em>lat_or_lon =
‘lat’</em>. That is, if you want to see latitude on the x-axis, then
specify <em>lat</em>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hovmoller.html">hovmoller</a></span><span class="op">(</span>lat_or_lon <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>                 x <span class="op">=</span> <span class="va">Tmax</span>,</span>
<span>                 lat_or_lon_col <span class="op">=</span> <span class="st">'lat'</span>,</span>
<span>                 t_col <span class="op">=</span> <span class="st">'t'</span>,</span>
<span>                 z_col <span class="op">=</span> <span class="st">'z'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">hov</span>, legend_title <span class="op">=</span> <span class="st">"Temperature"</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/hovm1-1.png" width="700"></p>
<p>The above graph gives valuable information. We see that at higher
latitudes the maximum temperature is low compared to lower latitudes.
There is another interesting bit of information. The dataset Tmax spans
150 days from May to September. This is from Spring to Autumn in the
Northern Hemisphere. Generally, the maximum daily temperature would go
up from May to July/August and then it would go down. This is confirmed
by the parabolic pattern of dark red/orange squares we see over
time.</p>
<p>If we want to see longitude on the x-axis (average by latitude), then
we need to specify <em>lat_or_lon = ‘lon’</em>. but this plot is not so
interesting.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hovmoller.html">hovmoller</a></span> <span class="op">(</span>lat_or_lon <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>                  x <span class="op">=</span> <span class="va">Tmax</span>,</span>
<span>                  lat_or_lon_col <span class="op">=</span> <span class="st">'lon'</span>,</span>
<span>                  t_col <span class="op">=</span> <span class="st">'t'</span>,</span>
<span>                  z_col <span class="op">=</span> <span class="st">'z'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">hov</span>, legend_title <span class="op">=</span> <span class="st">"Temperature"</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/hovm2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="ridgeline-plots">Ridgeline plots<a class="anchor" aria-label="anchor" href="#ridgeline-plots"></a>
</h3>
<p>Ridgeline plots show the distribution of a numeric value for
different groups. Let us look at the maximum temperature distribution
for different latitude values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/ridgeline.html">ridgeline</a></span><span class="op">(</span><span class="va">Tmax</span>, group_col <span class="op">=</span> <span class="st">'lat'</span>, z_col <span class="op">=</span> <span class="st">'z'</span> <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `stat(x)` was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `after_stat(x)` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">stxplore</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; Picking joint bandwidth of 1.76</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/ridgeline-1.png" width="700"></p>
<p>For higher latitudes, the maximum temperature distribution has a
longer left tail. That is, during certain periods the maximum
temperature is lower compared to lower latitudes.</p>
</div>
</div>
<div class="section level2">
<h2 id="investigating-the-covariance">Investigating the covariance<a class="anchor" aria-label="anchor" href="#investigating-the-covariance"></a>
</h2>
<p>Empirical covariances, spatio-temporal covariograms and
semivariograms are informative tools in spatio-temporal exploration. In
this section, we will look at plotting some of these objects. For more
details on covariances, semivariograms and orthogonal functions please
refer Chapter 2.4.2 in Spatio-Temporal Statistics with R by Christopher
K. Wikle, Andrew Zammit-Mangion and Noel Cressie.</p>
<div class="section level3">
<h3 id="empirical-covariances">Empirical covariances<a class="anchor" aria-label="anchor" href="#empirical-covariances"></a>
</h3>
<p>To explore the empirical covariances, we first remove the trends and
examine the residuals. The <em>emp_spatial_cov</em> function can remove
either linear or quadratic trends in space and time. If you set
<em>quadratic_time = TRUE</em> a quadratic trend is removed in time.
Similarly if you set <em>quadratic_space = TRUE</em>, a quadratic
component in space is removed. If these arguments are set to
<em>FALSE</em> only a linear trend is removed.</p>
<p>The <em>emp_spatial_cov</em> function can plot latitude or longitude
strips of empirical covariance. That is, you can divide the spatial
domain into strips corresponding to either latitude or longitude and
plot the associated covariance matrices for those strips.</p>
<p>Let’s see some longitudinal strips for this dataset after removing a
quadratic time and a linear space trend. We will see how they change
with latitude values.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">esv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emp_spatial_cov.html">emp_spatial_cov</a></span><span class="op">(</span><span class="va">Tmax</span>,</span>
<span>                       lat_col <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>                       lon_col <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>                       t_col <span class="op">=</span><span class="st">"t"</span>,</span>
<span>                       z_col <span class="op">=</span> <span class="st">"z"</span>,</span>
<span>                       num_strips <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                       quadratic_space <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                       quadratic_time <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       lat_or_lon_strips <span class="op">=</span> <span class="st">"lon"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">esv</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/stecov1-1.png" width="700"></p>
<p>Similarly, we can also plot latitude strips; the x axis will be
longitude then.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">esv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emp_spatial_cov.html">emp_spatial_cov</a></span><span class="op">(</span><span class="va">Tmax</span>,</span>
<span>                       lat_col <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>                       lon_col <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>                       t_col <span class="op">=</span><span class="st">"t"</span>,</span>
<span>                       z_col <span class="op">=</span> <span class="st">"z"</span>,</span>
<span>                       num_strips <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                       quadratic_space <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                       quadratic_time <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       lat_or_lon_strips <span class="op">=</span> <span class="st">"lat"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">esv</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/stecov2-1.png" width="700"></p>
<p>We can also compute the lagged covariance. We do this by setting the
<em>lag</em> parameter. Let’s see the lagged-1 empirical covariance for
this data after removing a quadratic trend in time.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># longitudinal strips</span></span>
<span><span class="va">esv1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emp_spatial_cov.html">emp_spatial_cov</a></span><span class="op">(</span><span class="va">Tmax</span>,</span>
<span>                        lat_col <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>                        lon_col <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>                        t_col <span class="op">=</span><span class="st">"t"</span>,</span>
<span>                        z_col <span class="op">=</span> <span class="st">"z"</span>,</span>
<span>                        num_strips <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                        quadratic_space <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        quadratic_time <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        lat_or_lon_strips <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>                        lag <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">esv1</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/stecov3-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># latitude strips</span></span>
<span><span class="va">esv2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emp_spatial_cov.html">emp_spatial_cov</a></span><span class="op">(</span><span class="va">Tmax</span>,</span>
<span>                        lat_col <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>                        lon_col <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>                        t_col <span class="op">=</span><span class="st">"t"</span>,</span>
<span>                        z_col <span class="op">=</span> <span class="st">"z"</span>,</span>
<span>                        num_strips <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                        quadratic_space <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        quadratic_time <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        lat_or_lon_strips <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>                        lag <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">esv2</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/stecov3-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="space-time-semi-variograms">Space-time semi-variograms<a class="anchor" aria-label="anchor" href="#space-time-semi-variograms"></a>
</h3>
<p>To plot space-time semi-variograms we need to construct an object of
STDF Class. We do this inside the function <em>semivariogram</em>. To
create an STDF object, we need spatio-temporal data with a full
spate-time grid. That is, we need a matrix of M x N size, where N is the
number of spatial locations and M is the number of timestamps. Let’s
have a look at these files.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Location data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">locs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">locs</span><span class="op">)</span></span>
<span><span class="co">#&gt;     id      lat       lon</span></span>
<span><span class="co">#&gt; 1 3804 39.35000 -81.43333</span></span>
<span><span class="co">#&gt; 2 3809 36.01667 -89.40000</span></span>
<span><span class="co">#&gt; 3 3810 35.73333 -81.38333</span></span>
<span><span class="co">#&gt; 4 3811 35.60000 -88.91666</span></span>
<span><span class="co">#&gt; 5 3812 35.43333 -82.48333</span></span>
<span><span class="co">#&gt; 6 3813 32.70000 -83.65000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">locs</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 328   3</span></span>
<span></span>
<span><span class="co"># Timestamp data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Times</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Times</span><span class="op">)</span></span>
<span><span class="co">#&gt;   julian year month day</span></span>
<span><span class="co">#&gt; 1 726834 1990     1   1</span></span>
<span><span class="co">#&gt; 2 726835 1990     1   2</span></span>
<span><span class="co">#&gt; 3 726836 1990     1   3</span></span>
<span><span class="co">#&gt; 4 726837 1990     1   4</span></span>
<span><span class="co">#&gt; 5 726838 1990     1   5</span></span>
<span><span class="co">#&gt; 6 726839 1990     1   6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Times</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1461    4</span></span>
<span></span>
<span><span class="co"># Spatio-temporal data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Tmax</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Tmax</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 1461  328</span></span></code></pre></div>
<p>For this dataset, NA values are stored as -9999. First we select part
of the dataset by subsetting the time component. We select the
appropriate rows in both Times and Tmax.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_part</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Selecting the dates from 0992-07-01 to 1992-07-31</span></span>
<span><span class="va">temp_part</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">temp_part</span><span class="op">)</span><span class="op">[</span><span class="fl">913</span><span class="op">:</span><span class="fl">943</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Tmax2</span> <span class="op">&lt;-</span> <span class="va">Tmax</span><span class="op">[</span><span class="fl">913</span><span class="op">:</span><span class="fl">943</span>, <span class="op">]</span></span></code></pre></div>
<p>Now we can plot the semi-variogram. Under the hood we use the
function <em>variogram</em> in the package <em>gstate</em> to produce
the semi-variogram. We include a bin size of 50km and up to 7 timelags.
We can specify if we need to remove the linear trend of the latitude or
longitude. First, let’s see what happens without removing the linear
trend.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">semiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/semivariogram.html">semivariogram</a></span><span class="op">(</span><span class="va">locs</span>,</span>
<span>        <span class="va">temp_part</span>,</span>
<span>        <span class="va">Tmax2</span>,</span>
<span>        latitude_linear <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        longitude_linear <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        missing_value <span class="op">=</span> <span class="op">-</span><span class="fl">9999</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">50</span>,</span>
<span>        cutoff <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>        tlagmax <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">semiv</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/stsemiv3-1.png" width="700"></p>
<p>Now let’s see what happens if we account for a linear trend in
latitude.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">semiv</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/semivariogram.html">semivariogram</a></span><span class="op">(</span><span class="va">locs</span>,</span>
<span>        <span class="va">temp_part</span>,</span>
<span>        <span class="va">Tmax2</span>,</span>
<span>        latitude_linear <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        longitude_linear <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        missing_value <span class="op">=</span> <span class="op">-</span><span class="fl">9999</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">50</span>,</span>
<span>        cutoff <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>        tlagmax <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">semiv</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/stsemiv4-1.png" width="700"></p>
<p>What about longitude?</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">semiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/semivariogram.html">semivariogram</a></span><span class="op">(</span><span class="va">locs</span>,</span>
<span>        <span class="va">temp_part</span>,</span>
<span>        <span class="va">Tmax2</span>,</span>
<span>        latitude_linear <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        longitude_linear <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        missing_value <span class="op">=</span> <span class="op">-</span><span class="fl">9999</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">50</span>,</span>
<span>        cutoff <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>        tlagmax <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">semiv</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/stsemiv5-1.png" width="700"></p>
<p>We see a big reduction in dark red squares when we include latitude,
but not so much when we include both latitude and longitude. That means,
there is a spatial component that we need to account for.</p>
</div>
</div>
<div class="section level2">
<h2 id="computations-similar-to-pca">Computations similar to PCA<a class="anchor" aria-label="anchor" href="#computations-similar-to-pca"></a>
</h2>
<div class="section level3">
<h3 id="empirical-orthogonal-functions-eof">Empirical Orthogonal Functions (EOF)<a class="anchor" aria-label="anchor" href="#empirical-orthogonal-functions-eof"></a>
</h3>
<p>Empirical orthogonal functions are the PCA equivalent to
spatio-temporal data.</p>
<p><span class="math display">\[Z(x,y,t) = \sum_{k = 1}^N \lambda_k
PC_k(t) \times EOF_k(x,y)\]</span> Here the multiplication denotes the
outer product. That is for each value of <span class="math inline">\(PC_k(t)\)</span>, <span class="math inline">\(EOF_k(x,y)\)</span> gets multiplied by it and we
get a 3D data cube. By adding <span class="math inline">\(N\)</span>
such data cubes we get <span class="math inline">\(Z\)</span> back.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">SSTlonlatshort</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">SSTdatashort</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">SSTlandmaskshort</span><span class="op">)</span></span>
<span><span class="co"># Take first 396 months (33 years) and delete land</span></span>
<span><span class="va">delete_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">SSTlandmaskshort</span>  <span class="op">==</span>  <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">SSTdatashort</span>   <span class="op">&lt;-</span> <span class="va">SSTdatashort</span><span class="op">[</span><span class="op">-</span><span class="va">delete_rows</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">396</span><span class="op">]</span></span>
<span><span class="va">eoff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emp_orth_fun.html">emp_orth_fun</a></span><span class="op">(</span><span class="va">SSTlonlatshort</span><span class="op">[</span><span class="op">-</span><span class="va">delete_rows</span>,  <span class="op">]</span>,</span>
<span>                     <span class="va">SSTdatashort</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">eoff</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/eof1-1.png" width="700"></p>
<p>That was the first EOF and PC time series. Let’s look at the second
EOF and associated time series.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">eoff</span>, EOF_num <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/eof2-1.png" width="700"></p>
<p>EOF is used as a dimension reduction tool.</p>
<p>The matrix below shows the correlation between the first 3 PC time
series. The off diagonal elements are very close to zero. Just like in
PCA, the PC time series are uncorrelated.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcs</span> <span class="op">&lt;-</span> <span class="va">eoff</span><span class="op">$</span><span class="va">pcts</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">EOF</span>, <span class="va">nPC</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">EOF</span>, values_from <span class="op">=</span> <span class="va">nPC</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cormat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">pcs</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">cormat</span></span>
<span><span class="co">#&gt;               X1            X2            X3</span></span>
<span><span class="co">#&gt; X1  1.000000e+00  1.306506e-17 -3.208918e-17</span></span>
<span><span class="co">#&gt; X2  1.306506e-17  1.000000e+00 -6.372879e-18</span></span>
<span><span class="co">#&gt; X3 -3.208918e-17 -6.372879e-18  1.000000e+00</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spatio-temporal-canonical-correlation-analysis">Spatio-temporal Canonical Correlation Analysis<a class="anchor" aria-label="anchor" href="#spatio-temporal-canonical-correlation-analysis"></a>
</h3>
<p>Canonical Correlation Analysis (CCA) is used to identify associations
between two sets of variables. For example suppose <span class="math inline">\(X_1, X_2, X_3\)</span> are variables from a
psychological survey of a set of participants. Let <span class="math inline">\(Y_1, Y_2, Y_3, Y_4\)</span> be a set of university
grades of the same set of participants. CCA finds new variables that
maximizes the correlation between X and Y sets of variables. For example
CCA finds <span class="math inline">\(U_1 = a_1 X_1 + a_2 X_2 + a_3
X_3\)</span> and <span class="math inline">\(V_1 = b_1 Y_1 + b_2 Y_2 +
b_3 Y_3 + b_4 Y_4\)</span> such that correlation between <span class="math inline">\(U_1\)</span> and <span class="math inline">\(V_1\)</span> is maximized. Similarly, it finds
<span class="math inline">\(U_2\)</span> and <span class="math inline">\(V_2\)</span> and so on.</p>
<p>In the spatio-temporal setting we can either use two different
datasets or we can use a lagged version of the same dataset. But, we
cannot implement the CCA on raw data because for most datasets the
unique time points <span class="math inline">\(T &lt; n\)</span> where
<span class="math inline">\(n\)</span> gives the number of spatial
points. Because of this we carry out CCA on Empirical Orthogonal
Functions of the data. Recall that EOFs find the temporal PC vectors and
the spatial EOF maps.</p>
<p><span class="math display">\[Z(x,y,t) = \sum_{k = 1}^N \lambda_k
PC_k(t) \times EOF_k(x,y)\]</span> We take a number of temporal PCs and
compute CCA on these. We can do it in two ways. If we’re interested in
future predictions of the same data, we can use a lagged dataset. In
this case, our first dataset will have <span class="math inline">\(PC_k(t)\)</span> for <span class="math inline">\(1
\leq t \leq (T - \ell)\)</span> for all <span class="math inline">\(k\)</span> where <span class="math inline">\(l\)</span> denotes the lag, and the second dataset
will have <span class="math inline">\(PC_k(t)\)</span> for <span class="math inline">\((\ell +1) \leq t \leq T\)</span> for all <span class="math inline">\(k\)</span>. This analysis will give us the new
variables. We will plot the first new temporal variable for the first
dataset and the first new temporal variable for the second dataset.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">SSTlonlatshort</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">SSTdatashort</span><span class="op">)</span></span>
<span><span class="va">cc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cancor_eof.html">cancor_eof</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">SSTlonlatshort</span>,</span>
<span>           lag <span class="op">=</span> <span class="fl">7</span>,</span>
<span>           n_eof <span class="op">=</span> <span class="fl">8</span>,</span>
<span>           values_df <span class="op">=</span> <span class="va">SSTdatashort</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Canonical Correlation Analysis is carried out using a lagged dataset."</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">cc1</span><span class="op">)</span></span></code></pre></div>
<p><img src="stxplore_files/figure-html/cancor-1.png" width="700"></p>
<p>We can also produce weighted maps. We can weight the EOF maps <span class="math inline">\(EOF_k(x,y)\)</span> by CCA coefficients. The map
above is such a weighted map.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sevvandi Kandanaarachchi, Petra Kunhert.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
